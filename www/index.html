<html>
  <!-- <style>
    table {
      font-family: arial, sans-serif;
      border-collapse: collapse;
      width: 100%;
    }

    td,
    th {
      border: 1px solid #000000;
      text-align: left;
      padding: 8px;
    }

    tr:nth-child(even) {
      background-color: #dddddd;
    }
  </style> -->
  <head>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="style.css" />

    <title>Tables</title>
    <script src="/rtl/jquery.js"></script>
    <script src="/rtl/smq.js"></script>
    <script>
      const split = window.location.href.split("/");
      const currentUrl = split[split.length - 1];

      console.log(currentUrl);

      $(function () {
        var smq = SMQ.Client(SMQ.wsURL("/QPCSBroker/"));
        // var smq = SMQ.Client("wss://simplemq.com/smq.lsp");

        function insertRow(time, state, elapsed) {
          var table = document.getElementById("myTable");
          var row = table.insertRow(table.rows.length);
          var cell1 = row.insertCell(0);
          var cell2 = row.insertCell(1);
          var cell3 = row.insertCell(2);
          cell1.innerHTML = time;
          cell2.innerHTML = state;
          cell3.innerHTML = elapsed;
        }

        function onValueUpdate(msg, ftid) {
          insertRow(msg.time, msg.state, msg.elapsed);
        }

        smq.subscribe("tableView", { onmsg: onValueUpdate, datatype: "json" });

        function onNavNames(msg, ftid) {
          const navList = document.getElementsByClassName("nav__list")[0];
          for (let i = 0; i < msg.length; i++) {
            const navItem = document.createElement("li");
            navItem.className = "nav__item";
            const aElement = document.createElement("a");
            aElement.className = "nav__link";
            if (msg[i].href === ".") {
              aElement.className = "active";
            }

            aElement.textContent = msg[i].name;

            aElement.href = msg[i].href;

            navItem.append(aElement);
            navList.append(navItem);
          }
        }

        smq.subscribe("nav_items_response", {
          onmsg: onNavNames,
          datatype: "json",
        });

        smq.publish("signal", "nav_names_request");
      });
    </script>
  </head>

  <body>
    <header class="header">
      <div class="header__content">
        <!-- <a class="logo"> </a> -->
        <nav class="nav">
          <ul class="nav__list"></ul>
        </nav>
      </div>
    </header>
    <h1 style="margin: 3%">ESS Viewer</h1>

    <section class="table__body">
      <table>
        <thead>
          <tr>
            <th>Time</th>
            <th>State</th>
            <th>Elapsed</th>
          </tr>
        </thead>
        <tbody id="myTable"></tbody>
      </table>
    </section>
  </body>
</html>
